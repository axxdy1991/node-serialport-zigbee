sudo mongod

npm start

            <% each item in gate %>
            <tr>
              <td><% item._id %></td>
              <td><% item.gatename %></td>
              <td><% item.operate %></td>
              <td><% item.pressure %></td>
              <td class="am-hide-sm-only"><% item.username %></td>
              <td class="am-hide-sm-only"><% item.meta.createAt %></td>
            </tr>



//chenney
//串口读
serialPort.once('data', function(data) { 
     if (data.toString().indexOf('U') > -1) { //check        
      //sendMessage(res, 'Unlocking!'); 
     } 
     else if (data.toString().indexOf('L') > -1) { 
       //sendMessage(res, 'Locking!'); 
     } 
     else { 
       console.log('ERROR'); 
     } 
     console.log('data received: ' + data); 
   }); 
 



serialPort.write("V", function(err, results) { 
     if (err) { 
       console.log('err ' + err); 
     } 
     console.log('results ' + results); 
   }); 




serialPort.open( function () { 
 // app.listen(3000); 
 // console.log('Listening on port 3000'); 
}); 






 
serialPort.open(function (error) {
  if ( error ) {
    console.log('failed to open: '+error);
  } else {
    console.log('open');
    //serialPort.on('data', function(data) {
    serialPort.on('data', function(data) {
      // console.log('data received: ' + data);
      var buff = new Buffer(data,'utf8');
      console.log('data received: ' + buff.toString('hex'));
    });
    // serialPort.write("ls\n", function(err, results) {
    //   console.log('err ' + err);
    //   console.log('results ' + results);
    // });
  }
});





var serialport = require("serialport");
serialport.list(function (err, ports) {
  ports.forEach(function(port) {
    console.log(port.comName);
    console.log(port.pnpId);
    console.log(port.manufacturer);
  });
});
























npm start


  
start the server with 

sudo mongod 

and then open another terminal and connect to that server with

 sudo mongo 


sudo mongod



 ifconfig | grep "inet " | grep -v 127.0.0.1





sudo service mongod stop
sudo mongod


sudo service mongodb stop

Last login: Tue Jul  7 13:05:00 on ttys001
ChenneyMacBook-Pro:~ Chenney$ ngrok 80









2657534E434E411B00000000000000000000000000000100454E44  //打开道闸

2657534E434E411B00000000000000000000000000010000454E44  //关闭道闸














ngrok                                                           (Ctrl+C to quit)
                                                                                
Tunnel Status                 online                                            
Version                       1.7/1.7                                           
Forwarding                    http://7c4dde0f.ngrok.com -> 127.0.0.1:80         
Forwarding                    https://7c4dde0f.ngrok.com -> 127.0.0.1:80        
Web Interface                 127.0.0.1:4040                                    
# Conn                        0                                                 
Avg Conn Time                 0.00ms                                            
                                                                                








ngrok -config ngrok.cfg -subdomain 7c4dde0f 3000






http://7c4dde0f.tunnel.mobi






































//打开serialport 
serialPort.open(function (error) {
  if ( error ) {
    console.log('failed to open: '+error);
  } else {
    console.log('Serialport is Opened');

  //读数据  
    serialPort.on('data', function(data) {
      var buff = new Buffer(data,'utf8');
      console.log('data received: ' + buff.toString('hex'));
    });

//关道闸
      var guanmen = new Buffer('2657534E434E411B00000000000000000000000000010000454E44','hex')
      var kaimen = new Buffer('2657534E434E411B00000000000000000000000000000100454E44','hex')

    serialPort.write(guanmen, function(err, results) {
      if(err){
        console.log('write err ' + err);
      }else{
        console.log('write results ' + results);
      }
    }); 

  }
});
























//打开serialport 
serialPort.open(function (error) {
  if ( error ) {
    console.log('failed to open: '+error);
  } else {
    console.log('Serialport is Opened');

  //读数据  
    serialPort.on('data', function(data) {
      var buff = new Buffer(data,'utf8');
      console.log('data received: ' + buff.toString('hex'));
    });

//关道闸
      var guanmen = new Buffer('2657534E434E411B00000000000000000000000000010000454E44','hex')
      var kaimen = new Buffer('2657534E434E411B00000000000000000000000000000100454E44','hex')


$('#lock').bind('click',function(){
 serialPort.write(guanmen, function(err, results) {
      if(err){
        console.log('write err ' + err);
      }else{
        console.log('write results ' + results);
      }
    }); 

  })



  }
});

































//打开serialport 
serialPort.open(function (error) {
  if ( error ) {
    console.log('failed to open: '+error);
  } else {
    console.log('Serialport is Opened');

  //读数据  
    serialPort.on('data', function(data) {
      var buff = new Buffer(data,'utf8');
      console.log('data received: ' + buff.toString('hex'));
    });

//关道闸
      var guanmen = new Buffer('2657534E434E411B00000000000000000000000000010000454E44','hex')
      var kaimen = new Buffer('2657534E434E411B00000000000000000000000000000100454E44','hex')


$('#lock').bind('click',function(){
 serialPort.write(guanmen, function(err, results) {
      if(err){
        console.log('lock err ' + err);
      }else{
        console.log('lock results ' + results);
      }
    }); //write guanmen
  })    //lock


$('#unlock').bind('click',function(){
 serialPort.write(kaimen, function(err, results) {
      if(err){
        console.log('unlock err ' + err);
      }else{
        console.log('unlock results ' + results);
      }
    }); //write guanmen
  })    //lock



  }     //else
});     //open
  










 
